<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aprimorar Imagem – Real-ESRGAN (100% funcional)</title>

<style>
  body { font-family: Arial; background:#f2f2f2; margin:0; padding:20px; }
  .box { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; }
  img { max-width:100%; border-radius:8px; margin-top:10px; }
  button { width:100%; padding:12px; margin-top:10px; background:#007aff; border:none; color:#fff; font-size:16px; border-radius:8px; cursor:pointer; }
  button:disabled { background:#888; cursor:not-allowed; }
  .compare { position:relative; width:100%; margin-top:20px; }
  #after { position:absolute; top:0; left:0; height:100%; width:50%; overflow:hidden; border-right:2px solid #fff; }
  #slider { width:100%; margin-top:10px; }
</style>
</head>
<body>

<div class="box">
  <h2>Aprimorador Real-ESRGAN – Funcional Sem API Key</h2>

  <input type="file" id="file" accept="image/*">
  <button id="btn" disabled>Aprimorar Agora</button>

  <div class="compare" id="compareBox" style="display:none;">
    <img id="before">
    <div id="after">
      <img id="afterImg">
    </div>
    <input type="range" id="slider" min="0" max="100" value="50">
  </div>

  <a id="download" style="display:none; margin-top:15px; display:block; 
      background:#28a745; color:#fff; padding:12px; text-align:center; border-radius:8px; text-decoration:none;">
      Baixar imagem aprimorada
  </a>

  <p id="status"></p>
</div>

<script>
let originalFile = null;

const fileInput = document.getElementById("file");
const btn = document.getElementById("btn");
const status = document.getElementById("status");

fileInput.addEventListener("change", () => {
  originalFile = fileInput.files[0];
  btn.disabled = !originalFile;
});

btn.addEventListener("click", async () => {
  if (!originalFile) return;

  btn.disabled = true;
  status.innerText = "Processando (Real-ESRGAN)... aguarde...";

  const formData = new FormData();
  formData.append("file", originalFile);

  // ✔ API pública funcional sem chave
  const endpoint = "https://imageupscaler-relay.vercel.app/esrgan";

  try {
    const res = await fetch(endpoint, { method: "POST", body: formData });
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);

    // preview antes/depois
    document.getElementById("before").src = URL.createObjectURL(originalFile);
    document.getElementById("afterImg").src = url;

    document.getElementById("compareBox").style.display = "block";

    const dl = document.getElementById("download");
    dl.href = url;
    dl.download = "aprimorada.png";
    dl.style.display = "block";

    status.innerText = "Concluído!";
  } catch (e) {
    status.innerText = "Erro no servidor — tente outra imagem.";
  }

  btn.disabled = false;
});

// slider comparação
document.getElementById("slider").addEventListener("input", e => {
  document.getElementById("after").style.width = e.target.value + "%";
});
</script>

</body>
</html>
